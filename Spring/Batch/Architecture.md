end-user 개발자를 위한 확장성과 사용 편의성을 지원하는 계층화된 아키텍처 이미지
![[assets/Pasted image 20241215185622.png]]


위 아키텍처는 세가지 주요 상위 구성 요소로 구성되어 있음
- Application
- Batch Core
- Infrastructure

**Application**
Spring Batch로 작성한 모든 배치 작업과 custom code가 포함되어있음

**Batch Core**
- 배치 작업을 시작하고 제어할 때 필요한 핵심 런타임 클래스가 포함
- `JobLauncher` , `Job`, `Step`에 대한 구현이 포함되어 있음


Application, Batch Core 는 Batch Infrastructure 위에 구축됨 

**Infrastructure**
개발자가 모두 사용하는 공통의 `Reader`(e.x. ItemReader), `Writer` (e.x. ItemWriter), `Service`(e.x. RetryTemplate)
코어 프레임워크 자체가 포함되어 있음 


## 기본적인 배치 Principles and Guidelines

1. 배치 아키텍처는 일반적으로 온라인 아키텍처에 영향을 미치며, 그 반대의 경우도 마찬가지입니다. 
   가능하면 공통 코드를 사용하여 아키텍처와 환경을 모두 염두에 두고 설계하세요.
2. 가능한 한 **단순화**하고 단일 배치 애플리케이션에서 복잡한 논리 구조를 구축하지 마세요.
3. 데이터의 처리와 저장을 물리적으로 가깝게 유지하세요(즉, 처리가 이루어지는 곳에 데이터를 보관하세요).
   `keep your data where your processing occurs`
4. 시스템 리소스 사용, 특히 I/O 사용을 최소화하세요. 내부 메모리에서 가능한 한 많은 작업을 수행하게 해야한다.
5. 애플리케이션 I/O(SQL 문 분석)를 검토하여 불필요한 물리적 I/O를 피하세요. 특히 다음 네 가지 일반적인 결함을 찾아야 합니다:
	1. 데이터를 한 번 읽고 캐시하거나 작업 스토리지에 보관할 수 있는 경우, 모든 트랜잭션에 대해 데이터를 읽는 경우
	2. 동일한 트랜잭션에서 이전에 데이터를 읽었던 트랜잭션의 데이터를 다시 읽는 경우
	3. 불필요한 테이블 또는 인덱스 스캔을 유발하는 경우
	4. SQL 문의 WHERE 절에 키 값을 지정하지 않은 경우
6. 일괄 실행에서 작업을 두 번 수행하지 마세요. 
   e.x.  보고 목적으로 데이터 요약이 필요한 경우, 데이터를 처음 처리할 때 가능한 경우 저장된 총계를 증분하여 보고 애플리케이션에서 동일한 데이터를 다시 처리할 필요가 없도록 해야 한다.
7. 배치 애플리케이션을 시작할 때 충분한 메모리를 할당하여, 프로세스 중에 시간이 많이 걸리는 재할당을 방지하세요.
8. 데이터 무결성과 관련해서는 항상 최악의 상황을 가정하세요. 데이터 무결성을 유지하기 위해 적절한 검사 및 기록 유효성 검사를 삽입하세요.
9. 실제 데이터 양이 많은 프로덕션 환경에서 가능한 한 빨리 스트레스 테스트를 계획하고 실행하세요.
10. 대규모 배치 시스템의 경우, 특히 시스템이 온라인 애플리케이션과 24시간 연중무휴로 동시에 실행되는 경우 백업이 어려울 수 있습니다. 데이터베이스 백업은 일반적으로 온라인 설계에서 잘 처리되지만 파일 백업도 그에 못지않게 중요하게 고려해야 합니다. 시스템이 플랫 파일에 의존하는 경우 파일 백업 절차를 마련하고 문서화할 뿐만 아니라 정기적으로 테스트해야 합니다.


# Batch Procesing Strategies

배치 시스템을 설계하고 구현하는 데 도움이 되도록 기본적인 배치 애플리케이션 빌딩 블록과 패턴을 샘플 구조 차트와 코드 셸의 형태로 설계자와 프로그래머에게 제공해야 합니다. 
배치 작업 설계를 시작할 때 비즈니스 로직은 다음과 같은 표준 빌딩 블록을 사용하여 구현할 수 있는 일련의 단계로 분해되어야 합니다:

1. `Conversion Applications` : 외부 시스템에서 제공하거나 외부 시스템용으로 생성된 각 파일 유형에 대해 제공된 거래 기록을 처리에 필요한 표준 형식으로 변환하기 위한 변환 애플리케이션을 만들어야 합니다. 이러한 유형의 배치 애플리케이션은 부분적으로 또는 전체적으로 변환 유틸리티 모듈로 구성될 수 있습니다
2. `Validation Applications` : 유효성 검사 애플리케이션은 모든 입력 및 출력 레코드가 정확하고 일관성이 있는지 확인합니다. 유효성 검사는 일반적으로 파일 헤더와 트레일러, 체크섬 및 유효성 검사 알고리즘, 레코드 수준 교차 검사를 기반으로 합니다.
3. `Extract Applications` : 추출 애플리케이션은 데이터베이스 또는 입력 파일에서 레코드 집합을 읽고, 미리 정의된 규칙에 따라 레코드를 선택한 다음, 출력 파일에 레코드를 씁니다.
4. `Extract/Update Applications` : 추출/업데이트 애플리케이션은 데이터베이스 또는 입력 파일에서 레코드를 읽고 각 입력 레코드에서 찾은 데이터에 따라 데이터베이스 또는 출력 파일을 변경합니다.
5. `Processing and Updating Applications` : 처리 및 업데이트 애플리케이션은 추출 또는 유효성 검사 애플리케이션의 입력 트랜잭션에 대한 처리를 수행합니다. 
   처리에는 일반적으로 처리에 필요한 데이터를 얻기 위해 데이터베이스를 읽고, 잠재적으로 데이터베이스를 업데이트하고, 출력 처리를 위한 레코드를 생성하는 작업이 포함됩니다.
6. `Output/Format Applications` : 출력/포맷 애플리케이션은 입력 파일을 읽고, 이 레코드의 데이터를 표준 형식에 따라 재구성한 후 인쇄 또는 다른 프로그램이나 시스템으로 전송하기 위한 출력 파일을 생성합니다.
7. 